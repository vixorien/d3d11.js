<!DOCTYPE html>
<html>
<head>
	<script src="../build/d3d11.js"></script>
</head>
<body>
	<h1>D3D11.js - API Initialization</h1>

	<canvas id="viewport" width="800" height="600"></canvas>

	<script>

		// Create/get the three API objects:
		// - Device: For resource/state creation
		// - Context: For changing graphics state and issuing rendering commands
		// - Swap Chain: Stores rendered data and presents finalized frames
		let device = D3D11CreateDevice(document.getElementById("viewport"));
		let context = device.GetImmediateContext();
		const swapDesc = new DXGI_SWAP_CHAIN_DESC(800, 600, DXGI_FORMAT_R8G8B8A8_UNORM);
		let swapChain = DXGICreateSwapChain(device, swapDesc);

		// Now that we have a swap chain, we can make a Render Target View for
		// its internal back buffer, allowing us to render into it.
		// - Note the null being passed to CreateRTV(), which signifies that a 
		//   default render target view should be created
		let swapBuffer = swapChain.GetBuffer(); // Also adds 1 to the buffer's reference count
		let backBufferRTV = device.CreateRenderTargetView(swapBuffer, null);
		swapBuffer.Release(); // Releases 1 reference to the buffer

		// Set this RTV as our rendering context's render target
		//  - Multiple render targets are possible, so the function takes an array of RTVs
		//  - No depth buffer for this demo, so setting that to null
		context.OMSetRenderTargets([backBufferRTV], null);

		// Clear the back buffer to a specified color
		let cornflowerBlue = [0.39, 0.58, 0.93, 1];
		context.ClearRenderTargetView(backBufferRTV, cornflowerBlue);

		// Present the frame to the user
		swapChain.Present();

	</script>
</body>
</html>

